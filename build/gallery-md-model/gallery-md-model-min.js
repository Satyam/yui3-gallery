YUI.add("gallery-md-model",function(a){var e=a.Lang,k=a.Array,j=a.Object,f="change",b="loaded",d="error",g="saved",c="isModified",i="isNew",h=".";a.GalleryModel=a.Base.create("gallery-md-model",a.Base,[],{_values:null,_loadedValues:null,_primaryKeys:null,initializer:function(){this._values={};this._loadedValues={};this.publish(f,{defaultFn:this._defSetValue});this.publish(b,{preventable:false,defaultFn:this._defDataLoaded});this.publish(g,{preventable:false});},destroy:function(m,o){if(typeof m==="function"){o=m;m={};}else{if(!m){m={};}}var l=this,n=function(p){if(!p){k.each(l.lists.concat(),function(q){q.remove(l,m);});a.GalleryModel.superclass.destroy.call(l);}o&&o.apply(null,arguments);};if(o||m){this.sync("delete",m,n);}else{n();}return this;},getValue:function(l){return(l?this._values[l]:a.clone(this._values));},getValues:function(){return this.getValue();},setValue:function(l,m,n){var o=this._values[l];if(o!==m&&(this._primaryKeys.indexOf(l)===-1||e.isUndefined(o))){this.fire(f,{name:l,newVal:m,prevVal:o,src:n});}},_defSetValue:function(l){this._values[l.name]=l.newVal;this._set(c,true);},setValues:function(m,n){var l=this;j.each(m,function(p,o){l.setValue(o,p,n);});},getChangedValues:function(){var n={},m,l=this._loadedValues;j.each(this._values,function(p,o){m=l[o];if(m!==p){n[o]={prevVal:m,newVal:p};}});return n;},getPKValues:function(){var m={},l=this;k.each(l.get("primaryKeys"),function(n){m[n]=l._values[n];});return m;},getAsHTML:function(l){var m=this.getValue(l);return a.Escape.html(e.isValue(m)?String(m):"");},getAsURL:function(m){var n=this.getValue(m),l=[];if(m){return encodeURIComponent(e.isValue(n)?String(n):"");}else{j.each(n,function(p,o){if(e.isValue(p)){l.push(encodeURIComponent(o)+"="+encodeURIComponent(p));}});return l.join("&");}},_defDataLoaded:function(m){var l=m.parsed;this._loadedValues=l;this.setValues(l,m.src);},load:function(m,n){var l=this;if(typeof m==="function"){n=m;m={};}else{if(!m){m={};}}l.sync("read",m,function(q,o){var p={options:m,response:o};if(q){p.error=q;p.src="load";l.fire(d,p);}else{p.parsed=l.parse(o);l.fire(b,p);l.changed={};l._set(c,false);l._set(i,false);}n&&n.apply(null,arguments);});return l;},parse:function(l){if(typeof l==="string"){try{return a.JSON.parse(l);}catch(m){this.fire(d,{error:m,response:l,src:"parse"});return null;}}return l;},save:function(m,n){var l=this;if(typeof m==="function"){n=m;m={};}else{if(!m){m={};}}l._validate(l.getValues(),function(o){if(o){n&&n.call(null,o);return;}l.sync(l.get(i)?"create":"update",m,function(r,p){var q={options:m,response:p};if(r){q.error=r;q.src="save";l.fire(d,q);}else{q.parsed=l.parse(p);if(q.parsed){l.fire(b,q);}l._set(c,false);l._set(i,false);l.changed={};l._loadedValues=a.clone(l._values);l.fire(g,q);}n&&n.apply(null,arguments);});});return l;},reset:function(l){if(l){this._values[l]=this._loadedValues[l];}else{this._values=a.clone(this._loadedValues);}return this;},sync:function(m,l,n){if(typeof n==="function"){n();}},validate:function(l,m){m&&m();},_validate:function(m,n){var l=this;l.validate(m,function(o){if(e.isValue(o)){l.fire(d,{attributes:m,error:o,src:"validate"});n(o);return;}n();});},toJSON:function(){return this.getValue();},_isModifiedGetter:function(n,m){m=m.split(h);if(m.length>1){m=m[1];var l={};l[m]=this._values[m]!==this._loadedValues[m];return l;}else{return n;}},_isNewGetter:function(n,m){m=m.split(h);if(m.length>1){m=m[1];var l={};l[m]=!this._loadedValues.hasOwnProperty(m);return l;}else{return n;}},_primaryKeysSetter:function(l){if(this._primaryKeys&&this._primaryKeys.length){return a.Attribute.INVALID_VALUE;}l=new k(l);this._primaryKeys=l;return l;},_primaryKeysGetter:function(n,m){m=m.split(h);if(m.length>1){m=m[1];var l={};l[m]=n.indexOf(m)!==-1;return l;}else{return(n||[]).concat();}}},{ATTRS:{isModified:{readOnly:true,value:false,validator:e.isBoolean,getter:"_isModifiedGetter"},isNew:{readOnly:true,value:true,validator:e.isBoolean,getter:"_isNewGetter"},primaryKeys:{setter:"_primaryKeysSetter",getter:"_primaryKeysGetter",lazyAdd:false,value:[]}}});a.GalleryModelSimpleUndo=function(){this._lastChange={};this.after(f,this._trackChange);};a.GalleryModelSimpleUndo.prototype={_trackChange:function(l){this._lastChange[l.name]=l.prevVal;},undo:function(m){var l=this;if(m){l._set(m,l._lastChange[m],{src:"undo"});}else{j.each(this._lastChange,function(o,n){l._set(n,o,{src:"undo"});});}}};},"@VERSION@",{requires:["base"],skinnable:false});