YUI.add("gallery-md-model",function(c,k){var h=c.Lang,n=c.Array,e=c.Object,o="change",s="loaded",b="error",l="saved",j="reset",x="isModified",y="isNew",u=".",q="Change",r="add",i="undo",f=function(){};c.GalleryModel=c.Base.create(k,c.Base,[],{_values:null,_loadedValues:null,_primaryKeys:null,initializer:function(z){this._values={};this._loadedValues={};this.publish(o,{defaultFn:this._defSetValue});this.publish(s,{defaultFn:this._defDataLoaded,preventedFn:this._stoppedDataLoaded,stoppedFn:this._stoppedDataLoaded});this.publish(l,{preventable:false});z=z||{};if(h.isObject(z.values)){this.after("init",this._setInitialValues);}},_setInitialValues:function(z){this.setValues(z.cfg.values,"init");this._set(x,false);this._set(y,true);this._loadedValues=c.clone(this._values);},destroy:function(A,C){if(h.isFunction(A)){C=A;A={};}else{if(!A){A={};}}C=C||f;var z=this,B=function(D){if(!D){n.each(z.lists.concat(),function(E){E.remove(z,A);});c.GalleryModel.superclass.destroy.call(z);}C.apply(z,arguments);};if(A.remove){this.sync("delete",A,B);}else{B();}return this;},getValue:function(z){return this._values[z];},getValues:function(){return c.clone(this._values);},setValue:function(z,A,B){var C=this._values[z];if(C!==A&&(this._primaryKeys.indexOf(z)===-1||h.isUndefined(C))){this.fire(o,{name:z,newVal:A,prevVal:C,src:B});}return this;},_defSetValue:function(A){var z=this;if(A.name){z._values[A.name]=A.newVal;z._set(x,true);}else{e.each(A.newVals,function(C,B){z.setValue(B,C,A.src);});}},setValues:function(B,C){var A=this,z={};e.each(B,function(E,D){z[D]=A.getValue(D);});this.fire(o,{newVals:B,prevVals:z,src:C});return A;},getChangedValues:function(){var B={},A,z=this._loadedValues;e.each(this._values,function(D,C){A=z[C];if(A!==D){B[C]={prevVal:A,newVal:D};}});return B;},getPKValues:function(){var A={},z=this;n.each(z._primaryKeys,function(B){A[B]=z._values[B];});return A;},getAsHTML:function(z){var A=this.getValue(z);return c.Escape.html(h.isValue(A)?String(A):"");},getAsURL:function(A){var B=this.getValue(A),z=[];if(A){return encodeURIComponent(h.isValue(B)?String(B):"");}e.each(B,function(D,C){if(h.isValue(D)){z.push(encodeURIComponent(C)+"="+encodeURIComponent(D));}});return z.join("&");},_defDataLoaded:function(A){var z=this;z.setValues(A.parsed,A.src);z._set(x,false);z._set(y,false);z._loadedValues=c.clone(z._values);A.callback.call(z,null,A.response);},_stoppedDataLoaded:function(z){z.details[0].callback.call(this,"Load event halted");},load:function(A,B){var z=this;if(h.isFunction(A)){B=A;A={};}else{if(!A){A={};}}B=B||f;z.sync("read",A,function(E,C){var D={options:A,response:C,src:"load",callback:B};if(E){D.error=E;z.fire(b,D);B.apply(z,arguments);}else{z._values={};D.parsed=z.parse(C);z.fire(s,D);}});return z;},parse:function(z){if(typeof z==="string"){try{return c.JSON.parse(z);}catch(A){this.fire(b,{error:A,response:z,src:"parse"});return null;}}return z;},save:function(A,B){var z=this;if(h.isFunction(A)){B=A;A={};}else{if(!A){A={};}}B=B||f;z._validate(z.getValues(),function(C){if(C){B.call(z,C);return;}z.sync(z.get(y)?"create":"update",A,function(F,D){var E={options:A,response:D,src:"save"};if(F){E.error=F;z.fire(b,E);}else{E.parsed=z.parse(D);E.callback=B;z._set(x,false);z._set(y,false);z._loadedValues=c.clone(z._values);z.fire(l,E);if(E.parsed){z.fire(s,E);return z;}}B.apply(z,arguments);});});return z;},reset:function(){this._values=c.clone(this._loadedValues);this.fire(j);return this;},sync:function(A,z,B){(B||f).call(this);},validate:function(z,A){(A||f).call(this);},_validate:function(A,B){var z=this;z.validate(A,function(C){if(h.isValue(C)){z.fire(b,{attributes:A,error:C,src:"validate"});B.call(z,C);return;}B.call(z);});},toJSON:function(){return this.getValues();},_isModifiedGetter:function(B,A){A=A.split(u);if(A.length>1){A=A[1];var z={};z[A]=this._values[A]!==this._loadedValues[A];return z;}return B;},_isNewGetter:function(B,A){A=A.split(u);if(A.length>1){A=A[1];var z={};z[A]=!this._loadedValues.hasOwnProperty(A);return z;}return B;},_primaryKeysSetter:function(z){if(this._primaryKeys&&this._primaryKeys.length){return c.Attribute.INVALID_VALUE;}z=new n(z);this._primaryKeys=z;return z;},_primaryKeysGetter:function(B,A){A=A.split(u);if(A.length>1){A=A[1];var z={};z[A]=B.indexOf(A)!==-1;return z;}return(B||[]).concat();}},{ATTRS:{isModified:{readOnly:true,value:false,validator:h.isBoolean,getter:"_isModifiedGetter"},isNew:{readOnly:true,value:true,validator:h.isBoolean,getter:"_isNewGetter"},primaryKeys:{setter:"_primaryKeysSetter",getter:"_primaryKeysGetter",lazyAdd:false,value:[]}}});c.GalleryModelSimpleUndo=function(){};c.GalleryModelSimpleUndo.prototype={initializer:function(){this._lastChange={};if(this._addPreserve){this._addPreserve("_lastChange");}this.after(o,this._trackChange);this.on([s,l,j],this._resetUndo);},_trackChange:function(z){if(z.name&&z.src!==i){this._lastChange[z.name]=z.prevVal;}},_resetUndo:function(){this._lastChange={};},undo:function(A){var z=this;if(A){if(z._lastChange[A]!==undefined){z.setValue(A,z._lastChange[A],i);delete z._lastChange[A];}}else{e.each(z._lastChange,function(C,B){if(C!==undefined){z.setValue(B,C,i);}});z._lastChange={};}return z;}};c.GalleryModelChronologicalUndo=function(){};c.GalleryModelChronologicalUndo.prototype={initializer:function(){this._changes=[];if(this._addPreserve){this._addPreserve("_changes");}this.after(o,this._trackChange);this.on([s,l,j],this._resetUndo);},_trackChange:function(z){if(z.src!==i){this._changes.push(z.details);}},_resetUndo:function(){this._changes=[];},undo:function(){var z=this._changes.pop();if(z){if(z.name){this.setValue(z.name,z.prevVal,i);}else{this.setValues(z.prevVals,i);}}if(this._changes.length===0){this._set(x,false);}return this;}};var w="index",p=function(){};p.prototype={_isYUIModelList:true,initializer:function(){this._shelves=[];this._currentIndex=0;this._addPreserve("_values","_loadedValues","_isNew","_isModified");},_setInitialValues:function(z){this.add(z.cfg.values);},_currentIndex:0,_shelves:null,_shelve:function(A){if(A===undefined){A=this._currentIndex;
}var z=this,B={};n.each(z._preserve,function(C){B[C]=z[C];});z._shelves[A]=B;},_fetch:function(A){if(A===undefined){A=this._currentIndex;}else{this._currentIndex=A;}var z=this,B=z._shelves[A];if(h.isUndefined(B)){this._initNew();}else{n.each(z._preserve,function(C){z[C]=B[C];});}},_addPreserve:function(){this._preserve=(this._preserve||[]).concat(Array.prototype.slice.call(arguments));},_initNew:function(){this._values={};this._loadedValues={};this._isNew=true;this._isModified=false;},add:function(A,B){var z=this;if(h.isArray(A)){n.each(A,function(D,C){z.add(D,(B?B+C:undefined));});return z;}if(z.get(x)||!z.get(y)){z._shelve();}if(B===undefined){B=z._shelves.length;}z._shelves.splice(B,0,{});z._currentIndex=B;z._initNew();z.setValues(A,r);return z;},each:function(A){var z=this;z._shelve();n.each(z._shelves,function(C,B){z._currentIndex=B;z._fetch(B);if(A.call(z,B)!==false){z._shelve(B);}});return z;},eachModified:function(A){var z=this;z._shelve();n.each(z._shelves,function(C,B){if(z._shelves[B][x]){z._currentIndex=B;z._fetch(B);if(A.call(z,B)!==false){z._shelve(B);}}});return z;},saveAllModified:function(){this.eachModified(this.save);return this;},_defDataLoaded:function(A){var z=this,B=z._shelves;if(h.isArray(A.parsed)){if(B.length&&(z.get(x)||!z.get(y))){z._shelve();}n.each(A.parsed,function(C){B.push({_values:C,_loadedValues:c.clone(C),isNew:false,isModified:false});});z._fetch();if(z._sort){z._sort();}A.callback.call(z,null,A.response);}else{c.GalleryModel.prototype._defDataLoaded.apply(z,arguments);}},size:function(){var z=0;n.each(this._shelves,function(){z+=1;});return z;},empty:function(){this._shelves=[];this._currentIndex=0;this.reset();return this;},_indexSetter:function(z){if(h.isNumber(z)&&z>=0&&z<this._shelves.length){this._shelve(this._currentIndex);this._currentIndex=z=parseInt(z,10);this._fetch(z);return z;}return c.Attribute.INVALID_VALUE;},_indexGetter:function(){return this._currentIndex;},_isNewGetter:function(A,z){if(z.split(u).length>1){return c.GalleryModel.prototype._isNewGetter.apply(this,arguments);}return this._isNew;},_isNewSetter:function(z){return(this._isNew=z);},_isModifiedGetter:function(A,z){if(z.split(u).length>1){return c.GalleryModel.prototype._isModifiedGetter.apply(this,arguments);}return this._isModified;},_isModifiedSetter:function(z){return(this._isModified=z);}};p.ATTRS={index:{value:0,setter:"_indexSetter",getter:"_indexGetter"},isNew:{setter:"_isNewSetter"},isModified:{setter:"_isModifiedSetter"}};c.GalleryModelMultiRecord=p;var t="sortField",a="sortDir",v="asc",d="desc",m=function(){};m.prototype={_compare:null,initializer:function(){if(this.get(t)===undefined){this._set(t,this.get("primaryKeys")[0]);}this._setCompare();this.after([t+q,a+q],this._sort);this.after(o,this._afterChange);},_setCompare:function(){var A=this.get(t),B=this.get(a)===v?1:-1,z=(h.isFunction(A)?A:function(C){return C[A];});this._compare=function(D,C){var F=z(D._values),E=z(C._values);return(F<E?-1:(F>E?1:0))*B;};},_sort:function(){this._setCompare();this._shelve();this._shelves.sort(this._compare);this._shelves.splice(this.size());this._fetch(0);},_afterChange:function(C){var F=C.name,z=this.get(t),B,A=this._currentIndex,E=this._shelves,D;if(F&&C.src!==r&&(h.isFunction(z)||F===z)){D=E.splice(A,1)[0];B=this._findIndex(D._values);E.splice(B,0,D);this._currentIndex=B;}},_findIndex:function(A){var F=this._shelves,z=0,E=F.length,B=0,C=this._compare,D={_values:A};while(z<E){B=Math.floor((E+z)/2);switch(C(D,F[B])){case 1:z=B+1;break;case -1:E=B;break;default:z=E=B;}}return z;},add:function(z){if(h.isArray(z)){n.each(z,this.add,this);return this;}var B=this._shelves,A=0;A=this._findIndex(z);this._currentIndex=A;B.splice(A,0,{});this._initNew();this.setValues(z,r);this._shelve(A);return this;},find:function(D,z){var C=this.get(t),B,A={};if(h.isFunction(C)){return null;}A[C]=D;B=this._findIndex(A);if(this._shelves[B]._values[C]!==D){return null;}if(z||arguments.length<2){this.set(w,B);}return B;}};m.ATTRS={sortField:{validator:function(z){return h.isString(z)||h.isFunction(z);}},sortDir:{validator:function(z){return z===d||z===v;},value:v}};c.GalleryModelSortedMultiRecord=m;var g=function(){};g.prototype={add:function(z){if(h.isArray(z)){n.each(z,this.add,this);return this;}if(this.get(x)||!this.get(y)){this._shelve();}this._currentIndex=z[this._primaryKeys[0]];this._initNew();this.setValues(z,r);return this;},_defDataLoaded:function(B){var z=this,C=z._shelves,A=z._primaryKeys[0];if(h.isUndefined(A)){return;}if(z.get(x)||!z.get(y)){z._shelve();}n.each(new n(B.parsed),function(D){C[D[A]]={_values:D,_loadedValues:c.clone(D),isNew:false,isModified:false};});n.some(C,function(E,D){z._fetch(D);return true;});B.callback.call(z,null,B.response);},next:function(){if(this.get(x)||!this.get(y)){this._shelve();}var B=this._shelves,A=this._currentIndex+1,z=B.length;while(A<z&&!B.hasOwnProperty(A)){A+=1;}if(A===z){return null;}this._fetch(A);return A;},previous:function(){if(this.get(x)||!this.get(y)){this._shelve();}var A=this._shelves,z=this._currentIndex-1;while(z>=0&&!A.hasOwnProperty(z)){z-=1;}if(z===-1){return null;}this._fetch(z);return z;}};c.GalleryModelPrimaryKeyIndex=g;},"@VERSION@",{"requires":["base"],"skinnable":false});