YUI.add("gallery-md-model",function(c){var g=c.Lang,l=c.Array,e=c.Object,m="change",q="loaded",b="error",j="saved",i="reset",u="isModified",w="isNew",s=".",o="Change",p="add",h="undo";c.GalleryModel=c.Base.create("gallery-md-model",c.Base,[],{_values:null,_loadedValues:null,_primaryKeys:null,initializer:function(x){this._values={};this._loadedValues={};this.publish(m,{defaultFn:this._defSetValue});this.publish(q,{defaultFn:this._defDataLoaded});this.publish(j,{preventable:false});x=x||{};if(g.isObject(x.values)){this.setValues(x.values,"init");this._set(u,false);this._set(w,true);this._loadedValues=c.clone(this._values);}},destroy:function(y,A){if(g.isFunction(y)){A=y;y={};}else{if(!y){y={};}}var x=this,z=function(B){if(!B){l.each(x.lists.concat(),function(C){C.remove(x,y);});c.GalleryModel.superclass.destroy.call(x);}if(g.isFunction(A)){A.apply(null,arguments);}};if(A||y){this.sync("delete",y,z);}else{z();}return this;},getValue:function(x){return this._values[x];},getValues:function(){return c.clone(this._values);},setValue:function(x,y,z){var A=this._values[x];if(A!==y&&(this._primaryKeys.indexOf(x)===-1||g.isUndefined(A))){this.fire(m,{name:x,newVal:y,prevVal:A,src:z});}},_defSetValue:function(y){var x=this;if(y.name){x._values[y.name]=y.newVal;x._set(u,true);}else{e.each(y.newVals,function(A,z){x.setValue(z,A,y.src);});}},setValues:function(z,A){var y=this,x={};e.each(z,function(C,B){x[B]=y.getValue(B);});this.fire(m,{newVals:z,prevVals:x,src:A});},getChangedValues:function(){var z={},y,x=this._loadedValues;e.each(this._values,function(B,A){y=x[A];if(y!==B){z[A]={prevVal:y,newVal:B};}});return z;},getPKValues:function(){var y={},x=this;l.each(x._primaryKeys,function(z){y[z]=x._values[z];});return y;},getAsHTML:function(x){var y=this.getValue(x);return c.Escape.html(g.isValue(y)?String(y):"");},getAsURL:function(y){var z=this.getValue(y),x=[];if(y){return encodeURIComponent(g.isValue(z)?String(z):"");}else{e.each(z,function(B,A){if(g.isValue(B)){x.push(encodeURIComponent(A)+"="+encodeURIComponent(B));}});return x.join("&");}},_defDataLoaded:function(y){var x=this;x.setValues(y.parsed,y.src);x._set(u,false);x._set(w,false);x._loadedValues=c.clone(x._values);},load:function(y,z){var x=this;if(g.isFunction(y)){z=y;y={};}else{if(!y){y={};}}x.sync("read",y,function(C,A){var B={options:y,response:A,src:"load"};if(C){B.error=C;x.fire(b,B);}else{x._values={};B.parsed=x.parse(A);x.fire(q,B);}if(g.isFunction(z)){z.apply(null,arguments);}});return x;},parse:function(x){if(typeof x==="string"){try{return c.JSON.parse(x);}catch(y){this.fire(b,{error:y,response:x,src:"parse"});return null;}}return x;},save:function(y,z){var x=this;if(g.isFunction(y)){z=y;y={};}else{if(!y){y={};}}x._validate(x.getValues(),function(A){if(A){if(g.isFunction(z)){z.call(null,A);}return;}x.sync(x.get(w)?"create":"update",y,function(D,B){var C={options:y,response:B,src:"save"};if(D){C.error=D;x.fire(b,C);}else{C.parsed=x.parse(B);x._set(u,false);x._set(w,false);x._loadedValues=c.clone(x._values);x.fire(j,C);if(C.parsed){x.fire(q,C);}}if(g.isFunction(z)){z.apply(null,arguments);}});});return x;},reset:function(){this._values=c.clone(this._loadedValues);this.fire(i);return this;},sync:function(y,x,z){if(g.isFunction(z)){z();}},validate:function(x,y){if(g.isFunction(y)){y();}},_validate:function(y,z){var x=this;x.validate(y,function(A){if(g.isValue(A)){x.fire(b,{attributes:y,error:A,src:"validate"});z(A);return;}z();});},toJSON:function(){return this.getValue();},_isModifiedGetter:function(z,y){y=y.split(s);if(y.length>1){y=y[1];var x={};x[y]=this._values[y]!==this._loadedValues[y];return x;}else{return z;}},_isNewGetter:function(z,y){y=y.split(s);if(y.length>1){y=y[1];var x={};x[y]=!this._loadedValues.hasOwnProperty(y);return x;}else{return z;}},_primaryKeysSetter:function(x){if(this._primaryKeys&&this._primaryKeys.length){return c.Attribute.INVALID_VALUE;}x=new l(x);this._primaryKeys=x;return x;},_primaryKeysGetter:function(z,y){y=y.split(s);if(y.length>1){y=y[1];var x={};x[y]=z.indexOf(y)!==-1;return x;}else{return(z||[]).concat();}}},{ATTRS:{isModified:{readOnly:true,value:false,validator:g.isBoolean,getter:"_isModifiedGetter"},isNew:{readOnly:true,value:true,validator:g.isBoolean,getter:"_isNewGetter"},primaryKeys:{setter:"_primaryKeysSetter",getter:"_primaryKeysGetter",lazyAdd:false,value:[]}}});c.GalleryModelSimpleUndo=function(){};c.GalleryModelSimpleUndo.prototype={initializer:function(){this._lastChange={};if(this._addPreserve){this._addPreserve("_lastChange");}this.after(m,this._trackChange);this.after([q,j,i],this._resetUndo);},_trackChange:function(x){if(x.name&&x.src!==h){this._lastChange[x.name]=x.prevVal;}},_resetUndo:function(){this._lastChange={};},undo:function(y){var x=this;if(y){if(x._lastChange[y]!==undefined){x.setValue(y,x._lastChange[y],h);delete x._lastChange[y];}}else{x.setValues(this._lastChange,h);x._lastChange={};}}};c.GalleryModelChronologicalUndo=function(){};c.GalleryModelChronologicalUndo.prototype={initializer:function(){this._changes=[];if(this._addPreserve){this._addPreserve("_changes");}this.after(m,this._trackChange);this.after([q,j,i],this._resetUndo);},_trackChange:function(x){if(x.src!==h){this._changes.push(x.details);}},_resetUndo:function(){this._changes=[];},undo:function(){var x=this._changes.pop();if(x){if(x.name){this.setValue(x.name,x.prevVal,h);}else{this.setValues(x.prevVals,h);}}if(this._changes.length===0){this._set(u,false);}}};var v="index",n=function(){};n.prototype={_isYUIModelList:true,initializer:function(){this._shelves=[];this._currentIndex=0;this._addPreserve("_values","_loadedValues","_isNew","_isModified");},_currentIndex:0,_shelves:null,_shelve:function(y){if(y===undefined){y=this._currentIndex;}var x=this,z={};l.each(x._preserve,function(A){z[A]=x[A];});x._shelves[y]=z;},_fetch:function(y){if(y===undefined){y=this._currentIndex;}else{this._currentIndex=y;}var x=this,z=x._shelves[y];if(g.isUndefined(z)){this._initNew();}else{l.each(x._preserve,function(A){x[A]=z[A];
});}},_addPreserve:function(){this._preserve=(this._preserve||[]).concat(Array.prototype.slice.call(arguments));},_initNew:function(){this._values={};this._loadedValues={};this._isNew=true;this._isModified=false;},add:function(x,y){if(this.get(u)||!this.get(w)){this._shelve();}if(arguments.length===2){this._shelves.splice(y,1);}else{y=this._shelves.length;}this._currentIndex=y;this._initNew();this.setValues(x,p);},each:function(y){var x=this;x._shelve();l.each(x._shelves,function(A,z){x._currentIndex=z;x._fetch(z);if(y.call(x,z)!==false){x._shelve(z);}});},eachModified:function(y){var x=this;x._shelve();l.each(x._shelves,function(A,z){if(x._shelves[z][u]){x._currentIndex=z;x._fetch(z);if(y.call(x,z)!==false){x._shelve(z);}}});},saveAllModified:function(){this.eachModified(this.save);},_defDataLoaded:function(y){var x=this,z=x._shelves;if(g.isArray(y.parsed)){if(z.length&&(x.get(u)||!x.get(w))){x._shelve();}l.each(y.parsed,function(A){z.push({_values:A,_loadedValues:c.clone(A),isNew:false,isModified:false});});x._fetch();if(x._sort){x._sort();}}else{c.GalleryModel.prototype._defDataLoaded.apply(x,arguments);}},size:function(){var x=0;l.each(this._shelves,function(){x+=1;});return x;},empty:function(){this._shelves=[];this._currentIndex=0;this.reset();},_indexSetter:function(x){if(g.isNumber(x)&&x>=0&&x<this._shelves.length){this._shelve(this._currentIndex);this._currentIndex=x=parseInt(x,10);this._fetch(x);return x;}else{return c.Attribute.INVALID_VALUE;}},_indexGetter:function(){return this._currentIndex;},_isNewGetter:function(y,x){if(x.split(s).length>1){return c.GalleryModel.prototype._isNewGetter.apply(this,arguments);}return this._isNew;},_isNewSetter:function(x){return(this._isNew=x);},_isModifiedGetter:function(y,x){if(x.split(s).length>1){return c.GalleryModel.prototype._isModifiedGetter.apply(this,arguments);}return this._isModified;},_isModifiedSetter:function(x){return(this._isModified=x);}};n.ATTRS={index:{value:0,setter:"_indexSetter",getter:"_indexGetter"},isNew:{setter:"_isNewSetter"},isModified:{setter:"_isModifiedSetter"}};c.GalleryModelMultiRecord=n;var r="sortField",a="sortDir",t="asc",d="desc",k=function(){};k.prototype={_compare:null,initializer:function(){if(this.get(r)===undefined){this._set(r,this.get("primaryKeys")[0]);}this._setCompare();this.after([r+o,a+o],this._sort);this.after("change",this._afterChange);},_setCompare:function(){var y=this.get(r),z=this.get(a)===t?1:-1,x=(g.isFunction(y)?y:function(A){return A[y];});this._compare=function(B,A){var D=x(B._values),C=x(A._values);return(D<C?-1:(D>C?1:0))*z;};},_sort:function(){this._setCompare();this._shelve();this._shelves.sort(this._compare);this._shelves.splice(this.size());this._fetch(0);},_afterChange:function(A){var D=A.name,x=this.get(r),z,y=this._currentIndex,C=this._shelves,B;if(D&&A.src!==p&&(g.isFunction(x)||D===x)){B=C.splice(y,1)[0];z=this._findIndex(B._values);C.splice(z,0,B);this._currentIndex=z;}},_findIndex:function(y){var D=this._shelves,x=0,C=D.length,z=0,A=this._compare,B={_values:y};while(x<C){z=Math.floor((C+x)/2);switch(A(B,D[z])){case 1:x=z+1;break;case -1:C=z;break;default:x=C=z;}}return x;},add:function(x){var z=this._shelves,y=0;y=this._findIndex(x);this._currentIndex=y;z.splice(y,0,{});this._initNew();this.setValues(x,p);this._shelve(y);},find:function(B,x){var A=this.get(r),z,y={};if(g.isFunction(A)){return null;}y[A]=B;z=this._findIndex(y);if(this._shelves[z]._values[A]!==B){return null;}if(x||arguments.length<2){this.set(v,z);}return z;}};k.ATTRS={sortField:{validator:function(x){return g.isString(x)||g.isFunction(x);}},sortDir:{validator:function(x){return x===d||x===t;},value:t}};c.GalleryModelSortedMultiRecord=k;var f=function(){};f.prototype={add:function(x){if(this.get(u)||!this.get(w)){this._shelve();}this._currentIndex=x[this._primaryKeys[0]];this._initNew();this.setValues(x,p);},_defDataLoaded:function(z){var x=this,A=x._shelves,y=x._primaryKeys[0];if(g.isUndefined(y)){return;}if(x.get(u)||!x.get(w)){x._shelve();}l.each(new l(z.parsed),function(B){A[B[y]]={_values:B,_loadedValues:c.clone(B),isNew:false,isModified:false};});l.some(A,function(C,B){x._fetch(B);return true;});},next:function(){if(this.get(u)||!this.get(w)){this._shelve();}var z=this._shelves,y=this._currentIndex+1,x=z.length;while(y<x&&!(y in z)){y+=1;}if(y===x){return null;}this._fetch(y);return y;},previous:function(){if(this.get(u)||!this.get(w)){this._shelve();}var y=this._shelves,x=this._currentIndex-1;while(x>=0&&!(x in y)){x-=1;}if(x===-1){return null;}this._fetch(x);return x;}};c.GalleryModelPrimaryKeyIndex=f;},"@VERSION@",{requires:["base"],skinnable:false});